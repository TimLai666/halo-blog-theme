<th:block xmlns:th="http://www.thymeleaf.org" th:fragment="headerFragment">
<header class="nb" th:classappend="${headerVariant} ?: ''">
  <div class="nb__inner">
    <a class="nb__brand" th:href="${site.url}" href="/">
      <span class="nb__dot" aria-hidden="true"></span>
      <span class="nb__title" th:text="${site.title}">Site</span>
      <span class="nb__subtitle" th:if="${site.subtitle}" th:text="${site.subtitle}"></span>
    </a>

    <nav class="nb__nav" aria-label="主選單"
         th:with="menu=${menuFinder.getPrimary()}, pages=${pageFinder.list(1, 50)}">
      <a class="nb__link" th:href="${site.url}" href="/">首頁</a>

      <th:block th:if="${menu != null}">
        <th:block th:each="mi : ${menu.menuItems}">
          <div class="nb__drop" th:if="${mi.children != null and !#lists.isEmpty(mi.children)}">
            <a class="nb__link nb__link--drop"
               th:href="@{${mi.status.href}}"
               th:text="${mi.status.displayName}"
               th:target="${mi.spec.target?.value}">
              Menu
            </a>
            <div class="nb__dropPanel" role="menu">
              <a class="nb__dropItem"
                 th:each="child : ${mi.children}"
                 th:href="@{${child.status.href}}"
                 th:text="${child.status.displayName}"
                 th:target="${child.spec.target?.value}">
                Child
              </a>
            </div>
          </div>

          <a class="nb__link"
             th:if="${mi.children == null or #lists.isEmpty(mi.children)}"
             th:href="@{${mi.status.href}}"
             th:text="${mi.status.displayName}"
             th:target="${mi.spec.target?.value}">
            Menu
          </a>
        </th:block>
      </th:block>

      <!-- 自動列出所有自訂頁面（避免漏掉頁面導致導覽不完整） -->
      <th:block th:if="${pages != null}">
        <div class="nb__drop" th:if="${pages.items != null and !#lists.isEmpty(pages.items)}">
          <a class="nb__link nb__link--drop" href="javascript:void(0)">頁面</a>
          <div class="nb__dropPanel" role="menu">
            <a class="nb__dropItem"
               th:each="pg : ${pages.items}"
               th:href="${pg.status.permalink}"
               th:text="${pg.spec.title}">
              Page
            </a>
          </div>
        </div>
      </th:block>
    </nav>

    <form class="nb__search" th:if="${theme.config.layout.show_search}">
      <input class="nb__searchInput" name="keyword" placeholder="搜尋文章…" autocomplete="off"/>
      <span class="nb__kbd" aria-hidden="true">⌘K</span>
    </form>
  </div>
</header>
</th:block>
